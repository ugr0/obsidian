# CASE式
SQL-92で標準SQLに取り入れられた。
「式」であるので、実行時には評価されて１つの値に定まる。

# CASE式の書式
```sql
-- 単純CASE式
CASE sex
	WHEN '1' THEN '男'
	WHEN '2' THEN '女'
ELSE 'その他' END

-- 検索CASE式
CASE WHEN sex = '1' THEN '男'
	 WHEN sex = '2' THEN '女'
ELSE 'その他' END
```

# CASE式の注意点
- 各分岐が返すデータ型を統一する
- ENDの書き忘れに注意
- ELSE句は必ずかく
  書かなくても暗黙的には「ELSE NULL」になるが、コード上で明らかに生成されることを示すために書いたほうが良い。

# CASE式はどこにでもかける
- SELECT句
- WHERE句
- GROUP BY句
- HAVING句
- ORDER BY句
- PARTITION BY句
- CHECK制約の中
- 関数の引数
- 述語の引数
- 他の式の中(CASE式自身も含む)

# 要点
1. GROUP BY 句でCASE式を使うことで、集約単位となるコードや階級を柔軟に設定できる。これは非定型的な集計に大きな威力を発揮する。
2. 集約関数の中に使うことで、行持ちから列持ちへの水平展開も自由自在。
3. 反対に集約関数を条件式に組み込むことでHAVING句を使わずにクエリをまとめられる。
4. 実装依存の関数より表現力が非常に強力な上、汎用性も高まって一石二鳥。
5. そうした利点があるのも、CASE式が「文」ではなく「式」であるからこそ。
6. CASE式を駆使することで複数のSQL文を一つにまとめられ、可読性もパフォーマンスも向上して良いことづくし。

# 参考資料
- [[📚達人に学ぶSQL徹底指南書第２版]]